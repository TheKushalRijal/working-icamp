// App.tsx
import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createNativeStackNavigator } from '@react-navigation/native-stack';
import { SafeAreaProvider } from 'react-native-safe-area-context';

import { AuthProvider } from './src/context/AuthContent';
import { EventProvider } from './src/context/EventContext';
import { useEffect } from 'react';
import { initBaseUrl } from './src/config/config';
// Screens
import Home from './src/pages/Home';
import Login from './src/pages/Registration/login';
import Register from './src/pages/Registration/register';
import LandingRedirect from './src/pages/Registration/landingpage';
import RidersApp from './src/rideshare/rideshare';
import Outside from './src/pages/UTA';
import UniversitySelection from './src/pages/university';
import StoresNearMe from './src/pages/stores';
import PersonalInfoPage from './src/profileredirect/important/personal';
import VisaPage from './src/profileredirect/important/visa';
import ScammersPage from './src/profileredirect/important/scammers';
import GroupsPage from './src/profileredirect/important/groups';
import UploadPost from './src/pages/uploadpost';
import UniversityResourcesPage from './src/profileredirect/community/resources';
import Test from './src/pages/test';
import ProfilePage from './src/profile/profilehome';
import Housings from './src/pages/housings';
import NepaliCalendar from './src/components/calander/calander';
import BottomNav from './src/components/navigation/BottomNav';
import CommunityGroupsScreen from './src/profileredirect/important/groups';
import LawyersScreen from './src/profileredirect/important/lawyers';
import AuthLoading from './src/pages/Registration/splashscreen';
import DiscountApp from './src/profileredirect/community/discounts';
import NameDescriptionList from './src/profileredirect/important/scammers';
import splitmain from './src/split/splitmain';
import Healthinsurance from './src/profileredirect/important/Insurance';

import TermsAndPrivac from './src/profileredirect/important/termsandcondition';

import DocumentHubScreen from './src/Documentlogic/DocumentHubScreen';
const Stack = createNativeStackNavigator();

function AppNavigator() {
  return (
     <Stack.Navigator initialRouteName="AuthLoading" screenOptions={{ headerShown: false }}>
            <Stack.Screen name="Main" component={Home} />

      <Stack.Screen name="AuthLoading" component={AuthLoading} />
      <Stack.Screen name="Login" component={Login} />

      {/* Show BottomNav as the main app shell for authenticated users */}
      <Stack.Screen name="Docs" component={DocumentHubScreen} />
      <Stack.Screen name="splitmain" component={splitmain} />

      <Stack.Screen name="Mains" component={BottomNav} />
      <Stack.Screen name="Lawyers" component={LawyersScreen} />

      <Stack.Screen name="Rides" component={RidersApp} />

      {/* Screens outside BottomNav (like auth & onboarding) */}
      <Stack.Screen name="Landing" component={LandingRedirect} />
      <Stack.Screen name="Register" component={Register} />
      <Stack.Screen name="insurance" component={Healthinsurance} />

      {/* Optional: other screens you want modally or outside of tabs */}
      <Stack.Screen name="UniversitySelection" component={UniversitySelection} />
      <Stack.Screen name="Store" component={StoresNearMe} />
      <Stack.Screen name="Personal" component={PersonalInfoPage} />
      <Stack.Screen name="Visa" component={VisaPage} />
      <Stack.Screen name="Scams" component={ScammersPage} />
      <Stack.Screen name="Groups" component={CommunityGroupsScreen} />
      <Stack.Screen name="UploadPost" component={UploadPost} />
      <Stack.Screen name="Resources" component={UniversityResourcesPage} />
      <Stack.Screen name="Test" component={Test} />
      <Stack.Screen name="Outside" component={Outside} />
      <Stack.Screen name="Upload" component={UploadPost} />
      <Stack.Screen name="terms" component={TermsAndPrivac} />


      <Stack.Screen name="Discounts" component={DiscountApp} />

    </Stack.Navigator>
  );
}



export default function App() {
  useEffect(() => {
    const setup = async () => {
      try {
        console.log('[App] Initializing base URL from GitHub config');
        await initBaseUrl();               // ðŸ‘ˆ sets DEV_BASE_URL + axios.defaults.baseURL
        console.log('[App] Base URL setup complete');
      } catch (err) {
        console.error('[App] Failed to init base URL:', err);
      }
    };

    setup();
  }, []);

  return (
    <SafeAreaProvider>
      <AuthProvider>
        <EventProvider>
          <NavigationContainer>
            <AppNavigator />
          </NavigationContainer>
        </EventProvider>
      </AuthProvider>
    </SafeAreaProvider>
  );
}